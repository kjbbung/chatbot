<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>일학습병행 전문 상담 챗봇</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: 'Inter', sans-serif; background: #f5f5f7; color: #111827; }
    .container { display: flex; flex-direction: column; height: 100vh; max-width: 700px; margin: 0 auto; background: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
    header { padding: 16px; background: #2563eb; color: #fff; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1d4ed8; }
    header h1 { font-size: 1.2rem; font-weight: 700; }
    header img { width: 40px; height: 40px; border-radius: 6px; object-fit: cover; }
    #chat { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
    .msg-wrap { display: flex; }
    .msg-wrap.user { justify-content: flex-end; }
    .msg-wrap.bot { justify-content: flex-start; }
    .bubble { max-width: 80%; padding: 10px 14px; border-radius: 12px; font-size: 0.875rem; line-height: 1.6; white-space: pre-wrap; word-break: break-word; }
    .bubble.user { background: #2563eb; color: #fff; border-bottom-right-radius: 2px; }
    .bubble.bot { background: #f3f4f6; color: #111827; border-bottom-left-radius: 2px; }
    .bubble.error { background: #fee2e2; color: #b91c1c; border-bottom-left-radius: 2px; }
    #loading { padding: 4px 16px 8px; color: #9ca3af; font-size: 0.8rem; display: none; }
    .input-area { padding: 12px 16px; border-top: 1px solid #e5e7eb; display: flex; gap: 8px; }
    #userInput { flex: 1; border: 1px solid #d1d5db; border-radius: 8px; padding: 8px 12px; font-size: 0.875rem; outline: none; }
    #userInput:focus { border-color: #2563eb; }
    #sendBtn { background: #2563eb; color: #fff; border: none; border-radius: 8px; padding: 8px 18px; font-size: 0.875rem; cursor: pointer; }
    #sendBtn:hover { background: #1d4ed8; }
    #sendBtn:disabled { background: #93c5fd; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>일학습병행 전문 상담 챗봇</h1>
      <img src="열공학습.jpg" alt="로고" onerror="this.style.display='none'">
    </header>
    <div id="chat"></div>
    <div id="loading">답변을 생성 중입니다...</div>
    <div class="input-area">
      <input type="text" id="userInput" placeholder="마음껏 물어보세요!" />
      <button id="sendBtn">전송</button>
    </div>
  </div>

  <script>
    const WORKER_URL = 'https://gemini-proxy.jubung31.workers.dev';

    const chat = document.getElementById('chat');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const loading = document.getElementById('loading');

    const SYSTEM_PROMPT = `당신은 대한민국 일학습병행제도 전문 상담 챗봇입니다.
한국산업인력공단 제주지사 소속으로, 일학습병행 관련 질문에 친절하고 정확하게 답변합니다.
답변은 항상 한국어로 하며, 전문적이고 친절한 어투를 사용합니다.`;

    let conversationHistory = [];

    function addMessage(text, role) {
      const wrap = document.createElement('div');
      wrap.className = `msg-wrap ${role}`;
      const bubble = document.createElement('div');
      bubble.className = `bubble ${role === 'error' ? 'error' : role}`;
      bubble.textContent = text;
      wrap.appendChild(bubble);
      chat.appendChild(wrap);
      chat.scrollTop = chat.scrollHeight;
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      addMessage(text, 'user');
      userInput.value = '';
      sendBtn.disabled = true;
      loading.style.display = 'block';

      conversationHistory.push({ role: 'user', parts: [{ text }] });

      try {
        const response = await fetch(WORKER_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            system_instruction: SYSTEM_PROMPT,
            contents: conversationHistory
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error?.message || `오류 코드: ${response.status}`);
        }

        const botText = data.candidates?.[0]?.content?.parts?.[0]?.text || '응답을 받을 수 없습니다.';
        conversationHistory.push({ role: 'model', parts: [{ text: botText }] });
        addMessage(botText, 'bot');
      } catch (err) {
        addMessage('오류가 발생했습니다: ' + err.message, 'error');
      } finally {
        sendBtn.disabled = false;
        loading.style.display = 'none';
        userInput.focus();
      }
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // 시작 메시지
    addMessage('안녕하세요! 일학습병행 전문 상담 챗봇입니다. 일학습병행제도에 관한 궁금한 사항을 편하게 질문해 주세요.', 'bot');
  </script>
</body>
</html>
