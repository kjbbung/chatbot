<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일학습병행 전문 상담 챗봇</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap">
    <style>
        body { font-family: 'Inter', ui-sans-serif, system-ui, sans-serif; background-color: #f5f5f7; color: #111827; }
        .markdown-body { font-size: 0.875rem; line-height: 1.6; }
        .animate-bounce { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); } 50% { transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18",
            "react-dom": "https://esm.sh/react-dom@18",
            "react-dom/client": "https://esm.sh/react-dom@18/client",
            "@google/genai": "https://esm.sh/@google/genai",
            "lucide-react": "https://esm.sh/lucide-react?external=react",
            "react-markdown": "https://esm.sh/react-markdown?external=react",
            "framer-motion": "https://esm.sh/framer-motion?external=react,react-dom"
        }
    }
    </script>
    <script type="module">
        import React, { useState, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";
        import * as Lucide from 'lucide-react';
        import ReactMarkdown from 'react-markdown';
        import { motion, AnimatePresence } from 'framer-motion';

        const { Send, Bot, User, Info, MessageSquare, ChevronRight, Sparkles, RotateCcw } = Lucide;

        // Configuration
        const GEMINI_API_KEY = "AIzaSyAgchrzk7ywmQtiD4tJwcKQdsOirLTyftQ";
        const getSafeImageUrl = (name) => "./" + encodeURIComponent(name);
        const BOT_PROFILE_IMAGE = getSafeImageUrl("이루미&해냄이(기본형).jpg");
        const HEADER_LOGO_IMAGE = getSafeImageUrl("제주지사_귤.jpg");

        const SYSTEM_INSTRUCTION = "당신은 '일학습병행' 제도 전문 상담 챗봇입니다. 제주지사 안내번호 064-729-0723을 답변 끝에 포함하세요.";

        function App() {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const chatEndRef = useRef(null);

            const handleSend = async (text = input) => {
                if (!text.trim() || isLoading) return;
                const userMsg = { role: 'user', content: text };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setIsLoading(true);

                try {
                    const genAI = new GoogleGenAI(GEMINI_API_KEY);
                    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                    const result = await model.generateContent(SYSTEM_INSTRUCTION + "

질문: " + text);
                    const aiText = result.response.text();
                    setMessages(prev => [...prev, { role: 'model', content: aiText }]);
                } catch (e) {
                    setMessages(prev => [...prev, { role: 'model', content: "API 오류가 발생했습니다. 키를 확인해 주세요." }]);
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => { chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

            return React.createElement('div', { className: 'flex flex-col h-screen max-w-2xl mx-auto bg-white shadow-xl' },
                React.createElement('header', { className: 'p-4 border-b flex justify-between items-center bg-blue-600 text-white' },
                    React.createElement('h1', { className: 'text-xl font-bold' }, '일학습병행 상담 챗봇'),
                    React.createElement('img', { src: HEADER_LOGO_IMAGE, className: 'w-10 h-10 rounded' })
                ),
                React.createElement('div', { className: 'flex-1 overflow-y-auto p-4 space-y-4' },
                    messages.map((m, i) => React.createElement('div', { key: i, className: `flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}` },
                        React.createElement('div', { className: `max-w-[80%] p-3 rounded-lg ${m.role === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-100'}` },
                            React.createElement(ReactMarkdown, null, m.content)
                        )
                    )),
                    isLoading && React.createElement('div', { className: 'text-gray-400' }, '답변 생성 중...'),
                    React.createElement('div', { ref: chatEndRef })
                ),
                React.createElement('div', { className: 'p-4 border-t flex gap-2' },
                    React.createElement('input', {
                        className: 'flex-1 border rounded p-2',
                        value: input,
                        onChange: e => setInput(e.target.value),
                        onKeyDown: e => e.key === 'Enter' && handleSend(),
                        placeholder: '질문을 입력하세요...'
                    }),
                    React.createElement('button', { onClick: () => handleSend(), className: 'bg-blue-600 text-white p-2 rounded' }, React.createElement(Send, { size: 20 }))
                )
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
