<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일학습병행 전문 상담 챗봇</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap">
    <style>
        body {
            font-family: 'Inter', ui-sans-serif, system-ui, sans-serif;
            background-color: #f5f5f7;
            color: #111827;
        }
        .font-mono {
            font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, monospace;
        }
        .markdown-body {
            font-size: 0.875rem;
            line-height: 1.625;
        }
        .markdown-body p {
            margin-bottom: 0.75rem;
        }
        .markdown-body p:last-child {
            margin-bottom: 0;
        }
        .markdown-body ul, .markdown-body ol {
            margin-bottom: 0.75rem;
            padding-left: 1.25rem;
            list-style-type: disc;
        }
        .markdown-body li {
            margin-bottom: 0.25rem;
        }
        .markdown-body strong {
            font-weight: 600;
        }
        .markdown-body code {
            background-color: #f3f4f6;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0,0,0.2,1); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@19",
            "react-dom": "https://esm.sh/react-dom@19/client",
            "react-dom/client": "https://esm.sh/react-dom@19/client",
            "@google/genai": "https://esm.sh/@google/genai",
            "lucide-react": "https://esm.sh/lucide-react",
            "react-markdown": "https://esm.sh/react-markdown",
            "framer-motion": "https://esm.sh/framer-motion"
        }
    }
    </script>

    <script type="module">
        import React, { useState, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";
        import { Send, Bot, User, Info, MessageSquare, ChevronRight, Sparkles, RotateCcw } from 'lucide-react';
        import Markdown from 'react-markdown';
        import { motion, AnimatePresence } from 'framer-motion';

        // --- CONFIGURATION ---
        // 이 부분의 따옴표 안에 본인의 Gemini API Key를 직접 입력하세요.
        const GEMINI_API_KEY = "AIzaSyAgchrzk7ywmQtiD4tJwcKQdsOirLTyftQ"; 
        // ---------------------

        const SYSTEM_INSTRUCTION = `
당신은 '일학습병행' 제도에 관한 전문 상담 챗봇입니다. 
다음 자료들을 기반으로 사용자(기업 담당자 또는 학습근로자)의 질문에 답변하십시오:
1. 「산업현장에서의 일학습병행 지원에 관한 법률」 및 시행령·시행규칙
2. 고용노동부 「일학습병행 운영규정(2025-99호)」
3. 최신 단가 자료 및 Q&A 지식베이스

상담 원칙:
- **참여 기업 요건**: 상시근로자 수는 '20인 이상(단, 기술력 및 여건 등에 따라 5인 이상도 참여 가능)'임을 반드시 안내하십시오.
- **학습근로자 참여 요건**: 해당 기업에 입사한 지 '3년 이내'인 신입사원이 대상임을 반드시 안내하십시오.
- **핵심 요약**: 모바일 가독성을 위해 키워드와 주제 중심으로 최대한 축약하여 답변하십시오.
- **근거 안내**: 답변 시 관련 규정이나 매뉴얼의 근거를 짧게 언급하십시오.
- **문의처 안내**: 답변의 마지막에는 반드시 "자세한 사항은 별도 문의를 통해 안내해 드립니다."라는 문구를 기재하십시오.
- **최종 확인**: 실제 신청·승인 여부는 한국산업인력공단 제주지사(064-729-0723)를 통해 확인해야 함을 안내하십시오.
- 답변은 마크다운 형식을 사용하여 가독성 있게 작성하십시오.
- 한국어로 답변하십시오.
`;

        const EXAMPLE_QUESTIONS = [
            {
                category: "기업 담당자",
                text: "기업 담당자인데, 우리 회사가 일학습병행에 참여할 수 있는지 참여요건을 알고 싶어요.",
                short: "기업 참여요건 확인"
            },
            {
                category: "학습근로자",
                text: "학습근로자로 채용되면 훈련시간, 임금, 수당이 어떻게 다른지 궁금합니다.",
                short: "학습근로자 처우 안내"
            },
            {
                category: "HRD-Net/절차",
                text: "신규 일학습병행 과정을 개설하려고 하는데, HRD-Net에서 어떤 순서로 입력해야 하나요?",
                short: "HRD-Net 입력 순서"
            },
            {
                category: "훈련 설계",
                text: "OJT와 Off-JT 시간 비율을 어떻게 맞춰야 하는지 알려 주세요.",
                short: "OJT/Off-JT 비율 설계"
            },
            {
                category: "비용/지원금",
                text: "전담인력 인건비와 훈련비·평가수당은 어떤 기준과 절차로 신청하나요?",
                short: "비용 및 지원금 신청"
            }
        ];

        function App() {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [apiKey, setApiKey] = useState(GEMINI_API_KEY);
            const chatEndRef = useRef(null);
            const chatContainerRef = useRef(null);

            const scrollToBottom = () => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            const handleReset = () => {
                setMessages([]);
                setInput('');
                setIsLoading(false);
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleSend = async (text = input) => {
                if (!text.trim() || isLoading) return;

                let currentKey = apiKey;
                if (!currentKey) {
                    currentKey = prompt("Gemini API Key를 입력해주세요:");
                    if (!currentKey) return;
                    setApiKey(currentKey);
                }

                const userMessage = { role: 'user', content: text };
                setMessages(prev => [...prev, userMessage]);
                setInput('');
                setIsLoading(true);

                try {
            const ai = new GoogleGenAI({ apiKey: currentKey });

            // Build conversation history with system instruction
            const contents = [
                { role: 'user', parts: [{ text: SYSTEM_INSTRUCTION }] },
                { role: 'model', parts: [{ text: '네, 일학습병행 전문 상담 챗봇입니다. 무엇을 도와드릴까요?' }] }
            ];

            // Add previous messages to history
            messages.forEach(m => {
                contents.push({
                    role: m.role === 'user' ? 'user' : 'model',
                    parts: [{ text: m.content }]
                });
            });

            // Add current user message
            contents.push({
                role: 'user',
                parts: [{ text: text }]
            });

            // Call API with full conversation history
            const result = await ai.models.generateContent({
                model: 'gemini-1.5-flash',
                contents: contents
            });

            const fullResponse = result.text;
            if (fullResponse) {
                setMessages(prev => [...prev, { role: 'model', content: fullResponse }]);
            
                } catch (error) {
                    console.error("Chat error:", error);
                    setMessages(prev => [...prev, { 
                        role: 'model', 
                        content: "죄송합니다. 답변을 생성하는 중에 오류가 발생했습니다. API Key가 올바른지 확인해 주세요." 
                    }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return React.createElement('div', { className: "flex justify-center items-stretch min-h-screen p-4 md:p-6" },
                React.createElement('div', { className: "flex flex-col w-full max-w-4xl gap-4 md:gap-6" },
                    React.createElement('header', { className: "flex flex-col gap-2" },
                        React.createElement('h1', { className: "text-2xl md:text-3xl font-bold tracking-tight flex items-center gap-2" },
                            "일학습병행 전문 상담 챗봇",
                            React.createElement(Sparkles, { className: "w-6 h-6 text-blue-600" })
                        ),
                        React.createElement('p', { className: "text-gray-600 text-sm md:text-base" },
                            "법·운영규정·최신 운영매뉴얼 기반으로 기업·학습근로자 질문에 답합니다."
                        )
                    ),
                    React.createElement('section', { className: "bg-white rounded-2xl p-5 md:p-6 shadow-sm border border-gray-200 flex flex-col gap-4" },
                        React.createElement('div', null,
                            React.createElement('h2', { className: "text-sm font-bold text-gray-900 mb-2 flex items-center gap-1.5" },
                                React.createElement(Info, { className: "w-4 h-4 text-blue-500" }),
                                "이 챗봇은 다음 자료를 기반으로 답변합니다."
                            ),
                            React.createElement('ul', { className: "text-sm text-gray-700 space-y-1 list-disc pl-5" },
                                React.createElement('li', null, "「산업현장에서의 일학습병행 지원에 관한 법률」 및 시행령·시행규칙"),
                                React.createElement('li', null, "고용노동부 「일학습병행 운영규정(2025-99호)」"),
                                React.createElement('li', null, "Q&A 지식베이스 및 최신 단가 자료")
                            )
                        ),
                        React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                            React.createElement('div', null,
                                React.createElement('h3', { className: "text-xs font-bold text-gray-500 uppercase tracking-wider mb-2" }, "주요 상담 대상"),
                                React.createElement('ul', { className: "text-sm text-gray-700 space-y-1" },
                                    React.createElement('li', { className: "flex items-center gap-2" }, React.createElement(ChevronRight, { className: "w-3 h-3 text-blue-400" }), " 일학습병행 준비·운영 기업 담당자"),
                                    React.createElement('li', { className: "flex items-center gap-2" }, React.createElement(ChevronRight, { className: "w-3 h-3 text-blue-400" }), " 참여(예정) 학습근로자")
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('h3', { className: "text-xs font-bold text-gray-500 uppercase tracking-wider mb-2" }, "문의 가능 내용"),
                                React.createElement('p', { className: "text-sm text-gray-700 leading-relaxed" },
                                    "제도 개요, 참여요건, 훈련 설계(OJT/Off-JT), 비용·지원금(최신 단가 기준), HRD-Net 절차 등"
                                )
                            )
                        ),
                        React.createElement('div', { className: "pt-2 border-t border-gray-100" },
                            React.createElement('p', { className: "text-[11px] text-gray-400 leading-normal" },
                                "※ 실제 신청·승인 여부 및 최종 금액은 한국산업인력공단 제주지사(064-729-0723)와 최신 공고문을 별도로 확인해 주세요.",
                                React.createElement('br'),
                                "※ 개별 분쟁에 대한 구체적 자문은 노무사·변호사 등 전문가 상담을 권장드립니다."
                            )
                        )
                    ),
                    React.createElement('main', { className: "flex-1 flex flex-col bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden min-h-[500px]" },
                        React.createElement('div', { className: "px-6 py-4 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between" },
                            React.createElement('div', { className: "flex items-center gap-3" },
                                React.createElement('div', { className: "w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white shadow-inner" },
                                    React.createElement(Bot, { className: "w-6 h-6" })
                                ),
                                React.createElement('div', null,
                                    React.createElement('h2', { className: "text-sm font-bold text-gray-900" }, "일학습병행 상담 AI"),
                                    React.createElement('p', { className: "text-xs text-gray-500" }, "법·운영규정 기반 전문 상담")
                                )
                            ),
                            React.createElement('div', { className: "flex items-center gap-2" },
                                React.createElement('span', { className: "text-[10px] font-bold px-2 py-1 bg-blue-100 text-blue-700 rounded-full uppercase" }, "Verified 2025.12")
                            )
                        ),
                        React.createElement('div', { ref: chatContainerRef, className: "flex-1 overflow-y-auto p-6 space-y-6 bg-white" },
                            messages.length === 0 ? 
                                React.createElement('div', { className: "flex flex-col gap-6 h-full justify-center items-center text-center max-w-md mx-auto" },
                                    React.createElement('div', { className: "space-y-2" },
                                        React.createElement('p', { className: "text-sm text-gray-500 font-medium" }, "예시 질문을 선택하거나 직접 질문을 작성해 보세요.")
                                    ),
                                    React.createElement('div', { className: "grid grid-cols-1 gap-3 w-full" },
                                        EXAMPLE_QUESTIONS.map((q, idx) => 
                                            React.createElement('button', {
                                                key: idx,
                                                onClick: () => handleSend(q.text),
                                                className: "text-left p-4 rounded-xl border border-gray-200 bg-white hover:border-blue-400 hover:bg-blue-50 transition-all group shadow-sm"
                                            },
                                                React.createElement('div', { className: "flex items-center justify-between mb-1" },
                                                    React.createElement('span', { className: "text-[10px] font-bold text-blue-600 uppercase tracking-wider" }, q.category),
                                                    React.createElement(ChevronRight, { className: "w-4 h-4 text-gray-300 group-hover:text-blue-500 transition-colors" })
                                                ),
                                                React.createElement('p', { className: "text-sm text-gray-800 font-medium leading-snug" }, q.text)
                                            )
                                        )
                                    )
                                ) : 
                                React.createElement(AnimatePresence, { initial: false },
                                    messages.map((m, idx) => 
                                        React.createElement(motion.div, {
                                            key: idx,
                                            initial: { opacity: 0, y: 10 },
                                            animate: { opacity: 1, y: 0 },
                                            className: `flex flex-col ${m.role === 'user' ? 'items-end' : 'items-start'}`
                                        },
                                            React.createElement('div', { className: `flex gap-3 max-w-[85%] ${m.role === 'user' ? 'flex-row-reverse' : 'flex-row'}` },
                                                React.createElement('div', { className: `w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm ${m.role === 'user' ? 'bg-gray-800 text-white' : 'bg-blue-600 text-white'}` },
                                                    m.role === 'user' ? React.createElement(User, { className: "w-5 h-5" }) : React.createElement(Bot, { className: "w-5 h-5" })
                                                ),
                                                React.createElement('div', { className: `p-4 rounded-2xl shadow-sm ${m.role === 'user' ? 'bg-gray-800 text-white rounded-tr-none' : 'bg-white border border-gray-100 text-gray-800 rounded-tl-none'}` },
                                                    React.createElement('div', { className: "markdown-body" },
                                                        React.createElement(Markdown, null, m.content)
                                                    )
                                                )
                                            ),
                                            m.role === 'model' && idx === messages.length - 1 && !isLoading && 
                                                React.createElement(motion.div, { initial: { opacity: 0 }, animate: { opacity: 1 }, className: "mt-4 ml-11" },
                                                    React.createElement('button', {
                                                        onClick: handleReset,
                                                        className: "flex items-center gap-1.5 px-4 py-2 text-xs font-semibold text-blue-600 bg-blue-50 border border-blue-100 rounded-full hover:bg-blue-100 transition-all shadow-sm"
                                                    },
                                                        React.createElement(RotateCcw, { className: "w-3.5 h-3.5" }),
                                                        React.createElement('span', null, "처음으로 돌아가기")
                                                    )
                                                )
                                        )
                                    )
                                ),
                            isLoading && React.createElement('div', { className: "flex justify-start" },
                                React.createElement('div', { className: "flex gap-3" },
                                    React.createElement('div', { className: "w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center shrink-0 shadow-sm" },
                                        React.createElement(Bot, { className: "w-5 h-5" })
                                    ),
                                    React.createElement('div', { className: "p-4 bg-white border border-gray-100 rounded-2xl rounded-tl-none shadow-sm" },
                                        React.createElement('div', { className: "flex gap-1" },
                                            React.createElement('span', { className: "w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce", style: { animationDelay: '0ms' } }),
                                            React.createElement('span', { className: "w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce", style: { animationDelay: '150ms' } }),
                                            React.createElement('span', { className: "w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce", style: { animationDelay: '300ms' } })
                                        )
                                    )
                                )
                            ),
                            React.createElement('div', { ref: chatEndRef })
                        ),
                        React.createElement('div', { className: "p-4 md:p-6 bg-gray-50 border-t border-gray-100" },
                            React.createElement('div', { className: "flex flex-col gap-3" },
                                React.createElement('div', { className: "relative flex items-center" },
                                    React.createElement('input', {
                                        type: "text",
                                        value: input,
                                        onChange: (e) => setInput(e.target.value),
                                        onKeyDown: (e) => e.key === 'Enter' && handleSend(),
                                        placeholder: "질문을 입력하세요 (예: 재직자 일학습병행 참여요건)",
                                        className: "w-full pl-5 pr-14 py-3.5 bg-white border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all shadow-sm text-sm",
                                        disabled: isLoading
                                    }),
                                    React.createElement('button', {
                                        onClick: () => handleSend(),
                                        disabled: isLoading || !input.trim(),
                                        className: "absolute right-2 p-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors shadow-md"
                                    },
                                        React.createElement(Send, { className: "w-5 h-5" })
                                    )
                                ),
                                React.createElement('div', { className: "flex items-center gap-2 px-2" },
                                    React.createElement(MessageSquare, { className: "w-3 h-3 text-gray-400" }),
                                    React.createElement('p', { className: "text-[10px] text-gray-400" },
                                        "개인정보(주민등록번호 등)는 입력하지 마세요. AI 답변은 참고용이며 최종 확인은 한국산업인력공단 제주지사(064-729-0723)를 통해 진행해 주세요."
                                    )
                                )
                            )
                        )
                    )
                )
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
